<!DOCTYPE html>
<html>
  <head>
      <title>Pesky - GDD 325</title>
  </head>
  <body>
      <script src="../pixi.min.js"></script>
      <script src="../bump.js"></script>
      <script src="../scaleToWindow.js"></script>
      <script src="../spriteUtilities.js"></script>
      <script src="../tink.js"></script>
      <script src="keyboardMovement.js"></script>
      <script src="animalObjects.js"></script>
      <script src="KeyboardPress.js"></script>
      <script src="EnemyAI.js"></script>
      <script src="UtilityFunctions.js"></script>
      <script src="spriteCreator.js"></script>
      <script>
        //Aliases
        // add the aliases for different pixi objects
        var Container = PIXI.Container,
          autoDetectRenderer = PIXI.autoDetectRenderer,
          loader = PIXI.loader,
          resources = PIXI.loader.resources,
          TextureCache = PIXI.utils.TextureCache,
          Texture = PIXI.Texture,
          Sprite = PIXI.Sprite,
          MovieClip = PIXI.extras.AnimatedSprite;


        //create the stage container
        var stage,
          renderer = autoDetectRenderer(1000, 1000);
        document.body.appendChild(renderer.view);

        //instantiate variables for the different scenes
        // Liable to change depening on how many houses there are
        var map = new Container(),
          house = new Container(),
          sewer = new Container();



        //scale the stage to the size of the browser window
        var scale = scaleToWindow(renderer.view);


        //instantiate the loader
        loader
          .add("../../images/AnimalPlaceHolder.png")
          .add("../../images/BackGround.png")
          .add("../../images/HouseBackground.png")
          .add("../../images/HouseOutside.png")
          .add("../../images/ACPH.png")
          .add("../../images/CarlosWalkCycle.png")
          .add("../../images/animal_control.png")
          .load(setup);

        //set the game state to use the play function
        // state can be used to assign many different things such as pause,
        // main menu, and game loss for example
        var state = play;


        //instantiate global variables that will be used in setup function and in
        // other locations
        var animalObject, animalObjectInverse, wTexture, tinkPoint, b, whiteFloor, animalTextures, animalAnimated,
          animalObjectTexture, houseBackground1, houseOutside1, houseBackgroundTexture1,
          houseOutsideTexture1, doorText, door;

        function setup() {
          b = new Bump(PIXI);
          //add the ability to add mouse/input events
          tinkPoint = new Tink(PIXI, renderer.view, scale);
          animalAnimated = new SpriteUtilities(PIXI);


          //create the background sprite out of the texture
          whiteFloor = new spriteCreator("../../images/BackGround.png", 1000, 1000);
          houseBackground1 = new spriteCreator("../../images/HouseBackground.png", 1000, 1000);
          houseOutside1 = new spriteCreator("../../images/HouseOutside.png", 400, 400);
          door = new spriteCreator("../../images/AnimalPlaceHolder.png", 80, 80)


          //TODO shift from basic Sprite Object TO an animated sprite Object
          // Maybe extend a class or look at API for pixi and Animations

          //create the animal object and its texture from the cache
          animalObject = new spriteCreator("../../images/CarlosWalkCycle.png", 55, 45);


          //call the function to build the outside map
          buildOutside();

          //calls function that designates what each key does when it is pressed
          Keys();

          //calls the game loop that runs the game logic
          gameLoop();
        }


        function play() {
          //add x velocity to player's x location
          animalObject.x += animalObject.vx;

          //checks when to apply gravity to the player object
          if (!(player.sprite.y > player.lowestHeight)) {
            player.sprite.vy += 0.3;
          }

          //checkes when to add the y velocity to the player object
          // TODO change this when we add floors/platforms to jump on
          animalObject.y += animalObject.vy;

          //add x and y velocities to the animal control object
          aCObject.x += aCObject.vx;
          aCObject.y += aCObject.vy;

          //call functions for player and ai logic
          jump();
          aiMovemnt();
        }

        function gameLoop() {
          requestAnimationFrame(gameLoop);
          state();
          tinkPoint.update();
          renderer.render(stage);
        }
        </script>
  </body>
</html>
